import{h as e,withDirectives as n,vShow as t,resolveDirective as o,defineComponent as a,ref as l,computed as r,onMounted as d,onBeforeUnmount as s,openBlock as c,createElementBlock as u,toDisplayString as i,createCommentVNode as p,createElementVNode as f,normalizeClass as m,onBeforeMount as v,onUnmounted as g,watch as h,warn as y,normalizeStyle as b,renderSlot as x,resolveComponent as $,createBlock as N,Teleport as S,createVNode as D,withCtx as E,nextTick as C,reactive as z,Transition as k,Fragment as O,renderList as M,vModelText as w,createSlots as R}from"vue";var _="vue3-tree-org",F="3.1.2";const B=function(e){return"[object Object]"===Object.prototype.toString.call(e)},A=function(e){return"string"==typeof e},T=function(e){return"number"==typeof e},L={print:(e,n,t)=>A(n)||"boolean"==typeof t,pretty:(e,n,t)=>A(n)&&A(e)||"string"==typeof t,primary:(e,n)=>A(e)||"boolean"==typeof n,success:(e,n)=>A(e)||"boolean"==typeof n,info:(e,n)=>A(e)||"boolean"==typeof n,warning:(e,n)=>A(e)||"boolean"==typeof n,danger:(e,n)=>A(e)||"boolean"==typeof n};function j(e="default"){let n="";switch(e){case"primary":n="#2d8cf0";break;case"success":n="#19be6b";break;case"info":n="#909399";break;case"warning":n="#ff9900";break;case"danger":n="#ff4d4f";break;case"default":n="#35495E";break;default:n=e}return n}L.print=function(e,n="default",t=!1){return"object"==typeof e?(console.dir(e),!0):(t?console.log(`%c ${e} `,`background:${j(n)}; padding: 2px; border-radius: 4px;color: #fff;`):console.log(`%c ${e} `,`color: ${j(n)};`),!0)},L.pretty=function(e,n,t="primary"){return console.log(`%c ${e} %c ${n} %c`,`background:${j(t)};border:1px solid ${j(t)}; padding: 1px; border-radius: 4px 0 0 4px; color: #fff;`,`border:1px solid ${j(t)}; padding: 1px; border-radius: 0 4px 4px 0; color: ${j(t)};`,"background:transparent"),!0},L.primary=function(e,n=!1){return this.print&&this.print(e,"primary",n),!0},L.success=function(e,n=!1){return this.print&&this.print(e,"success",n),!0},L.info=function(e,n=!1){return this.print&&this.print(e,"info",n),!0},L.warning=function(e,n=!1){return this.print&&this.print(e,"warning",n),!0},L.danger=function(e,n=!1){return this.print&&this.print(e,"danger",n),!0};var V={async install(e){e.config.globalProperties.$log=L,L.pretty("["+_+"] "+F,"success")}};const Y=function(e,n,t){const{id:o,children:a}=n;if(e[o]===t)return e;if(Array.isArray(e[a])){const o=e[a];for(let e=0,a=o.length;e<a;e++){const a=o[e],l=Y(a,n,t);if(l)return l}}},X=function(e,n){const{parenNode:t,onlyOneNode:o,cloneNodeDrag:a}=n;if(t.value){const{keys:l}=n,{id:r,pid:d}=l,s=t.value.$$data,c=JSON.parse(JSON.stringify(e.$$data));if(a){!function(e,n,t){const{children:o}=n;if(B(e))a(e);else if(Array.isArray(e))for(let n=0,t=e.length;n<t;n++)a(e[n]);function a(e){if(t(e),Array.isArray(e[o])){const n=e[o];for(let e=0,t=n.length;e<t;e++)a(n[e])}}}(c,l,(function(e){"string"==typeof e[r]&&-1!==e[r].indexOf("clone-node")&&(e[r]=`clone-node-${e[r]}`)}));const{children:e}=l;o&&Array.isArray(c[e])&&(c[e]=[]),c[l.pid]=s[l.id],s.children?s.children.push(c):s.children=[c]}else!function(e,n){const{keys:t,data:o,onlyOneNode:a}=n,{id:l,pid:r,children:d}=t,s=Y(o,t,e[r]),c=s[d];let u;for(let n=0,t=c.length;n<t;n++)if(c[n][l]===e[l]){c.splice(n,1),u=n;break}const i=e[d];a&&void 0!==u&&i&&(e[d]=[],i.forEach((e=>{e[r]=s[l]})),s[d].splice(u,0,...i))}(c,n),c[d]=s[r],s.children?s.children.push(c):s.children=[].concat(c)}},P={beforeMount(e,n){const{l:t,t:o}=n.modifiers,{drag:a,dragData:l,node:r,handleStart:d,handleMove:s,handleEnd:c}=n.value,{value:u}=n,i={...l};e.addEventListener("mousedown",(function(e){e.stopPropagation();const n=e.target;if(!1===a||0!==e.button||r.focused||r.noDragging||n.className.indexOf("tree-org-node-btn")>-1)return!1;(function(e){v=e.screenX,g=e.screenY,f=0,i.contextmenu.value=!1;const{keys:n,onlyOneNode:t}=i;if(t){const{children:e}=n;console.log(r,114);const t={...r.$$data};t[e]=[],i.cloneData.value=t}else i.cloneData.value=r.$$data})(e),document.addEventListener("mousemove",h),document.addEventListener("mouseup",y),b("start")}));let p,f=0,m=!1,v=0,g=0;function h(n){return n.preventDefault(),!(Math.abs(n.screenX-v)<5&&Math.abs(n.screenY-g)<5)&&(m||(m=!0,function(n){i.nodeMoving.value=!0,r.moving=!0;let t=e;for(;!t.classList.contains("tree-org-node");)f+=t.offsetLeft,t=t.offsetParent;f+=2,p=document.querySelector("#clone-tree-org"),p&&(p.style.width=`${t.clientWidth}px`,p.style.opacity="0.8",p.style.left=n.clientX-f+"px",p.style.top=n.clientY+2+"px")}(n)),t&&o&&u?(p&&(p.style.left=n.clientX-f+"px",p.style.top=n.clientY+2+"px"),void b("move")):t&&u?(e.style.left=n.clientX-f+"px",void b("move")):void(o&&u&&(e.style.top=n.clientY+"px",b("move"))))}function y(e){if(document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",y),!m)return;m=!1,p=null,r.moving=!1,i.nodeMoving.value=!1;const n=document.querySelector(".tree-org-node__moving");if(n&&n.contains(e.target))return b("end",!0),!1;X(r,i),b("end",!1)}function b(e,n){"start"!==e?"move"!==e?"end"===e&&"function"==typeof c&&c(r,n):"function"==typeof s&&s(r):"function"==typeof d&&d(r)}}};const q={onClick:"onNodeClick",onDblclick:"onNodeDbclick",onContextmenu:"onNodeContextmenu",onMouseenter:"onNodeMouseenter",onMouseleave:"onNodeMouseleave"};function U(e,n){if("function"==typeof e)return function(t){t.target.className.indexOf("org-tree-node-btn")>-1||e(t,n)}}const W=(e,n)=>!(Array.isArray(e[n])&&e[n].length>0)||e.isLeaf,K=(e,o,a)=>{const{attrs:l}=a,r=["tree-org-node"],d=[],{expand:s,$$level:c,children:u,id:i}=o;void 0===s&&c<l.defaultExpandLevel&&(o.expand=!0);const p=o.expand;return W(o,"children")?r.push("is-leaf"):l.collapsable&&!p&&r.push("collapsed"),o.moving&&r.push("tree-org-node__moving"),d.push(I(e,o,a)),l.collapsable&&!p||d.push(J(e,u,a)),n(e("div",{class:r,key:i},d),[[t,!o.hidden]])},I=(e,a,l)=>{const{attrs:r}=l,d=r.props,s=r.renderContent,{label:c}=a,u=[];if(l.slots.default)u.push(l.slots.default({node:a}));else if("function"==typeof s){L.warning("scoped-slot header is easier to use. We recommend users to use scoped-slot header.");const n=s(e,a);n&&u.push(n)}else u.push(e("div",{class:"tree-org-node__text"},c));r.collapsable&&!W(a,"children")&&u.push(((e,n,t)=>{const{attrs:o}=t,a=o.onOnExpand,l=["tree-org-node__expand"];n.expand&&l.push("expanded");const r=[];return t.slots.expand?r.push(t.slots.expand({node:n})):r.push(e("span",{class:"tree-org-node__expand-btn"})),e("span",{class:l,onClick:e=>{e.stopPropagation(),a&&a(e,n)}},r)})(e,a,l));const i=["tree-org-node__inner"];let{labelStyle:p,labelClassName:f,selectedClassName:m,selectedKey:v}=r;"function"==typeof f&&(f=f(a)),f&&i.push(f),a.className&&i.push(a.className),"function"==typeof m&&(m=m(a)),void 0!==v&&(v=Array.isArray(v)?v:[v]),m&&v&&v.includes(a.id)&&i.push(m);const g=["tree-org-node__content"];a.$$root&&g.push("is-root"),a.label||g.push("is-empty"),a.$$focused&&g.push("is-edit");const h=o("nodedrag"),y=[];r.vNodedrag&&h&&!a.$$root&&y.push([h,Object.assign({node:a},r.vNodedrag),"",{l:!0,t:!0}]);const b={};for(const e in q)if(Object.prototype.hasOwnProperty.call(q,e)){const n=r[q[e]];n&&(b[e]=U(n,a))}const x=r.onNodeFocus,$=r.onNodeBlur,N=o("focus"),S=[[t,a.$$focused]];return N&&S.push([N,a.$$focused]),e("div",{class:g},[n(e("div",{class:i,style:a.style?a.style:p,...b},u),y),n(e("textarea",{class:"tree-org-node__textarea",placeholder:"请输入节点名称",value:a.label,onFocus:e=>{x&&x(e,a.$$data,a)},onInput:e=>{a.label=e.target.value},onBlur:e=>{void 0!==a.$$data.focused&&(a.$$data.focused=!1),a.$$data[d.label]=e.target.value,a.$$focused=!1,$&&$(e,a.$$data,a)},onClick:e=>e.stopPropagation()}),S)])},J=(e,n,t)=>{if(Array.isArray(n)&&n.length){const o=n.filter((e=>!e.$$hidden)).map((n=>K(e,n,t)));return e("div",{class:"tree-org-node__children"},o)}return""},H=(n,t)=>n.data?(n.data.$$root=!n.isClone,K(e,n.data,t)):"";H.directives={focus:{mounted(e,{value:n}){n&&e.focus()},updated(e,{value:n}){n&&e.focus()}},nodedrag:P};var G=a({props:{scale:String,tools:Object},setup(e,{emit:n}){const t=l(!1),o=l(!1);function a(e){o.value=!o.value,n("onFullscreen",e)}function c(){document.isFullScreen||document.mozIsFullScreen||document.webkitIsFullScreen||!o.value||a("esc")}const u=r((()=>t.value?"全部收起":"全部展开")),i=r((()=>o.value?"退出全屏":"全屏"));return d((()=>{window.addEventListener("resize",c)})),s((()=>{window.removeEventListener("resize",c)})),{expanded:t,fullscreen:o,expandTitle:u,fullTiltle:i,handleExpand:function(){t.value=!t.value,n("onExpand")},handleScale:function(e){"out"===e?n("onScale",.1):"in"===e?n("onScale",-.1):n("onRestore")},handleFullscreen:a}}});const Q={class:"zm-tree-handle"},Z={key:0,class:"zm-tree-percent"},ee=["title"],ne={class:"zm-tree-svg"},te=[f("span",{class:"zm-tree-icon"},"+",-1)],oe=[f("span",{class:"zm-tree-icon"},"-",-1)],ae=[f("span",{class:"zm-tree-restore"},null,-1)],le=["title"],re={class:"zm-tree-svg"};function de(e){return"function"==typeof e||"[object Function]"===Object.prototype.toString.call(e)}function se(e,n,t,o=1){return{deltaX:Math.round(n/o/e[0])*e[0],deltaY:Math.round(t/o/e[1])*e[1]}}function ce(e,n,t){return e<n?n:t<e?t:e}G.render=function(e,n,t,o,a,l){return c(),u("div",Q,[e.tools.scale?(c(),u("div",Z,i(e.scale),1)):p("v-if",!0),e.tools.expand?(c(),u("div",{key:1,onClick:n[0]||(n[0]=(...n)=>e.handleExpand&&e.handleExpand(...n)),title:e.expandTitle,class:"zm-tree-handle-item"},[f("span",ne,[f("i",{class:m(["iconfont",e.expanded?"icon-collapse":"icon-expand"])},null,2)])],8,ee)):p("v-if",!0),e.tools.zoom?(c(),u("div",{key:2,onClick:n[1]||(n[1]=n=>e.handleScale("out")),title:"放大",class:"zm-tree-handle-item zoom-out"},te)):p("v-if",!0),e.tools.zoom?(c(),u("div",{key:3,onClick:n[2]||(n[2]=n=>e.handleScale("in")),title:"缩小",class:"zm-tree-handle-item zoom-in"},oe)):p("v-if",!0),e.tools.restore?(c(),u("div",{key:4,onClick:n[3]||(n[3]=n=>e.handleScale("restore")),title:"还原",class:"zm-tree-handle-item"},ae)):p("v-if",!0),e.tools.fullscreen?(c(),u("div",{key:5,onClick:n[4]||(n[4]=(...n)=>e.handleFullscreen&&e.handleFullscreen(...n)),title:e.fullTiltle,class:"zm-tree-handle-item"},[f("span",re,[f("i",{class:m(["iconfont",e.fullscreen?"icon-unfullscreen":"icon-fullscreen"])},null,2)])],8,le)):p("v-if",!0)])},G.__file="src/components/tools/tools.vue";const ue=function(e,n,t,o=!1){e&&n&&t&&e.addEventListener(n,t,o)},ie=function(e,n,t,o=!1){e&&n&&t&&e.removeEventListener(n,t,o)},pe=(e,{emit:n},t)=>{const o={start:"mousedown",move:"mousemove",stop:"mouseup"},a={start:"touchstart",move:"touchmove",stop:"touchend"},s={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},c={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"};let u=o;const i=l(e.x),p=l(e.y),f=l(e.z),m=l(e.active),y=l(!1),b=l(0),x=l(0),$=l(0),N=l(0),S=l(0),D=l(0);let E={},C={};function z(){E={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},C={minLeft:-1/0,maxLeft:1/0,minRight:-1/0,maxRight:1/0,minTop:-1/0,maxTop:1/0,minBottom:-1/0,maxBottom:1/0}}function k(){if(e.parent){const[e,n]=O();S.value=e||0,D.value=n||0}}function O(){if(e.parent&&t.eleRef.value){const e=window.getComputedStyle(t.eleRef.value.parentNode,null);return[parseInt(e.getPropertyValue("width"),10),parseInt(e.getPropertyValue("height"),10)]}return[0,0]}function M(o){if(o instanceof MouseEvent&&1!==o.which)return;const a=o.target||o.srcElement;if(a&&t.eleRef.value&&t.eleRef.value.contains(a)){if(e.dragCancel&&function(e,n,t){let o=e;const a=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].find((e=>o&&de(o[e])))||"";if(!de(o[a]))return!1;do{if(o[a](n))return!0;if(o===t)return!1;o=o.parentNode}while(o);return!1}(a,e.dragCancel,t.eleRef.value))return void(y.value=!1);m.value||(m.value=!0,n("activated"),n("update:active",!0)),e.draggable&&(y.value=!0),o instanceof MouseEvent?(E.mouseX=o.pageX,E.mouseY=o.pageY):(E.mouseX=o.touches[0].pageX,E.mouseY=o.touches[0].pageY),E.left=i.value,E.right=b.value,E.top=p.value,E.bottom=x.value,e.parent&&(C=w()),ue(document.documentElement,u.move,_),ue(document.documentElement,u.stop,F)}}function w(){const n=e.grid;return{minLeft:i.value%n[0],maxLeft:Math.floor((S.value-$.value-i.value)/n[0])*n[0]+i.value,minRight:b.value%n[0],maxRight:Math.floor((S.value-$.value-b.value)/n[0])*n[0]+b.value,minTop:p.value%n[1],maxTop:Math.floor((D.value-N.value-p.value)/n[1])*n[1]+p.value,minBottom:x.value%n[1],maxBottom:Math.floor((D.value-N.value-x.value)/n[1])*n[1]+x.value}}function R(o){const a=o.target||o.srcElement;t.eleRef.value&&!t.eleRef.value.contains(a)&&m.value&&!e.preventDeactivation&&(m.value=!1,n("deactivated"),n("update:active",!1))}function _(t){y.value&&function(t){const o=e.axis,a=e.grid;let l=0,r=0;t instanceof MouseEvent?(l=t.pageX,r=t.pageY):(l=t.touches[0].pageX,r=t.touches[0].pageY);const d=o&&"y"!==o?E.mouseX-l:0,s=o&&"x"!==o?E.mouseY-r:0,{deltaX:c,deltaY:u}=se(a,d,s,e.scale),f=ce(E.left-c,C.minLeft,C.maxLeft),m=ce(E.top-u,C.minTop,C.maxTop),v=ce(E.right+c,C.minRight,C.maxRight),g=ce(E.bottom+u,C.minBottom,C.maxBottom);i.value=f,p.value=m,b.value=v,x.value=g,n("dragging",i.value,p.value)}(t)}function F(){z(),y.value&&(y.value=!1,n("dragstop",i.value,p.value))}v((()=>{z()})),d((()=>{!e.enableNativeDrag&&t.eleRef.value&&(t.eleRef.value.ondragstart=()=>!1);const[n,o]=O();if(S.value=n,D.value=o,t.eleRef.value){const[e,n]=function(e){const n=window.getComputedStyle(e);return[parseFloat(n.getPropertyValue("width")),parseFloat(n.getPropertyValue("height"))]}(t.eleRef.value);$.value=e,N.value=n,b.value=S.value-$.value-i.value,x.value=D.value-N.value-p.value}ue(document.documentElement,"mousedown",R),ue(document.documentElement,"touchend touchcancel",R),ue(window,"resize",k)})),g((()=>{ie(document.documentElement,"mousedown",R),ie(document.documentElement,"touchstart",F),ie(document.documentElement,"mousemove",_),ie(document.documentElement,"touchmove",_),ie(document.documentElement,"mouseup",F),ie(document.documentElement,"touchend touchcancel",R),ie(window,"resize",k)}));const B=r((()=>({transform:`translate(${i.value}px, ${p.value}px)`,zIndex:f.value,...y.value&&e.disableUserSelect?s:c})));return h((()=>e.active),(e=>{m.value=e,n(e?"activated":"deactivated")})),h((()=>e.z),(e=>{(e>=0||"auto"===e)&&(f.value=e)})),h((()=>e.x),(n=>{y.value||(e.parent&&(C=w()),function(n){const{deltaX:t}=se(e.grid,n,p.value,e.scale),o=ce(t,C.minLeft,C.maxLeft);i.value=o,b.value=S.value-$.value-o}(n))})),h((()=>e.y),(n=>{y.value||(e.parent&&(C=w()),function(n){const{deltaY:t}=se(e.grid,i.value,n,e.scale),o=ce(t,C.minTop,C.maxTop);p.value=o,x.value=D.value-N.value-o}(n))})),{enabled:m,dragging:y,style:B,resetBoundsAndMouseState:z,elementTouchDown:function(e){u=a,M(e)},elementMouseDown:function(e){u=o,M(e)}}};"production"===process.env.NODE_ENV||Object.freeze({}),"production"===process.env.NODE_ENV||Object.freeze([]);const fe=Symbol("wrapper");function me(e,n){if(null===(t=e)||"object"!=typeof t||e.__elPropsReservedKey)return e;var t;const{values:o,required:a,default:l,type:r,validator:d}=e,s=o||d?e=>{let t=!1,a=[];if(o&&(a=[...o,l],t=t||a.includes(e)),d&&(t=t||d(e)),!t&&a.length>0){const t=[...new Set(a)].map((e=>JSON.stringify(e))).join(", ");y(`Invalid prop: validation failed${n?` for prop "${n}"`:""}. Expected one of [${t}], got value ${JSON.stringify(e)}.`)}return t}:void 0;return{type:"object"==typeof r&&Object.getOwnPropertySymbols(r).includes(fe)?r[fe]:r,validator:s,__elPropsReservedKey:!0,default:l,required:!!a}}const ve=e=>function(e){let n=-1;const t=e?e.length:0,o={};for(;++n<t;){const t=e[n];o[t[0]]=t[1]}return o}(Object.entries(e).map((([e,n])=>[e,me(n,e)]))),ge=e=>({[fe]:e});var he=a({replace:!0,name:"Draggable",props:ve({className:{type:String,default:"zm-draggable"},classNameDraggable:{type:String,default:"draggable"},classNameDragging:{type:String,default:"dragging"},classNameActive:{type:String,default:"active"},disableUserSelect:{type:Boolean,default:!0},enableNativeDrag:{type:Boolean,default:!1},preventDeactivation:{type:Boolean,default:!1},active:{type:Boolean,default:!1},draggable:{type:Boolean,default:!0},x:{type:Number,default:0},y:{type:Number,default:0},z:{type:[String,Number],default:"auto",validator:e=>"string"==typeof e?"auto"===e:e>=0},dragCancel:String,axis:{type:String,default:"both",validator:e=>["x","y","both"].includes(e)},grid:{type:Array,default:()=>[1,1]},parent:{type:Boolean,default:!1},scale:{type:Number,default:1,validator:e=>e>0}}),emits:{activated:()=>!0,deactivated:()=>!0,dragging:(e,n)=>T(e)&&T(n),dragstop:(e,n)=>T(e)&&T(n),"update:active":e=>"boolean"==typeof e},setup(e,n){const t=l(),o=pe(e,n,{eleRef:t});return{top:top,eleRef:t,...o}}});he.render=function(e,n,t,o,a,l){return c(),u("div",{style:b(e.style),class:m([{[e.classNameActive]:e.enabled,[e.classNameDragging]:e.dragging,[e.classNameDraggable]:e.draggable},e.className]),ref:"eleRef",onMousedown:n[0]||(n[0]=(...n)=>e.elementMouseDown&&e.elementMouseDown(...n)),onTouchstart:n[1]||(n[1]=(...n)=>e.elementTouchDown&&e.elementTouchDown(...n))},[x(e.$slots,"default")],38)},he.__file="src/components/draggable/src/draggable.vue";var ye=a({components:{TreeOrgNode:H},props:ve({data:{type:Object,required:!0},props:{type:ge(Object)},modelValue:Boolean,horizontal:Boolean,selectedKey:String,collapsable:Boolean,renderContent:Function,labelStyle:Object,labelClassName:{type:[Function,String]}})});const be={id:"clone-tree-org",class:"clone-tree-org tree-org"};ye.render=function(e,o,a,l,r,d){const s=$("tree-org-node");return c(),N(S,{to:"body"},[n(f("div",be,[D(s,{data:e.data,props:e.props,isClone:!1,horizontal:e.horizontal,labelStyle:e.labelStyle,collapsable:e.collapsable,renderContent:e.renderContent,labelClassName:e.labelClassName},{default:E((({node:n})=>[x(e.$slots,"default",{node:n})])),expand:E((({node:n})=>[x(e.$slots,"expand",{node:n})])),_:3},8,["data","props","horizontal","labelStyle","collapsable","renderContent","labelClassName"])],512),[[t,e.modelValue]])])},ye.__file="src/components/clone-org/clone-org.vue";const xe=(e,{emit:n},t)=>{const o=l("");function a(e,n,t){if(e[n]===t)return e;if(Array.isArray(e.children)){const o=e.children;for(let e=0,l=o.length;e<l;e++){const l=a(o[e],n,t);if(l)return l}}}function s(){const{props:t,data:o,node:l}=e;if(e.nodeDelete)return void e.nodeDelete(l.$$data);if(l.$$root)return void L.pretty("[提示] ","根节点不允许删除","danger");const{id:r,children:d}=t,s=a(o,r,l.pid);if(s){const e=s[d];for(let t=0,o=e.length;t<o;t++)if(e[t][r]===l.id){e.splice(t,1),n("onNodeDelete",l.$$data,l);break}}}function c(){const{nodeEdit:t,node:o}=e;t?t(o.$$data):(o.$$focused=!0,n("onNodeFocus",o.$$data))}function u(o){if(e.modelValue){if(t.eleRef.value&&t.eleRef.value.contains(o.target))return!1;n("update:modelValue",!1)}}const i=r((()=>({left:`${e.x}px`,top:`${e.y}px`}))),p=r((()=>!e.disabled&&!e.node.disabled));return d((()=>{document.addEventListener("mousedown",u)})),g((()=>{document.removeEventListener("mousedown",u)})),{position:i,editable:p,handleMenu:function(a){const l=a.target;if("zm-tree-menu-item"===l.className){const a=l.getAttribute("action");switch(a){case"copy":!function(){if(e.nodeCopy)return void e.nodeCopy(e.node.$$data);o.value=e.node.label,C((()=>{t.inputRef&&t.inputRef.value&&(t.inputRef&&t.inputRef.value.select(),navigator.clipboard.writeText(o.value).then((function(){L.pretty("[提示] ","文本复制成功","success")}),(function(){L.pretty("[错误] ","浏览器不支持","danger")})),n("onNodeCopy",o.value))}))}();break;case"add":!function(){if(e.nodeAdd)return void e.nodeAdd(e.node.$$data);const{id:t,pid:o,label:a,expand:l,children:r}=e.props,{node:d}=e,s={[t]:String((new Date).getTime()),[o]:d.id,[a]:"",[l]:!1,[r]:[],newNode:!0,focused:!0};Array.isArray(d.children)?d.$$data[r].push(s):d.$$data[r]=[s];n("onNodeFocus",s)}();break;case"edit":c();break;case"delete":s()}n("contextmenu",{command:a,node:e.node,data:e.node.$$data}),n("update:modelValue",!1)}},handleEdit:c,handleClose:u,afterEnter:function(){n("opened")},afterLeave:function(){n("closed")}}};var $e=a({name:"Contextmenu",props:ve({modelValue:{type:Boolean,required:!0},data:{type:Object,required:!0},node:{type:ge(Object),required:!0},props:{type:ge(Object)},x:Number,y:Number,menus:{type:ge(Array)},nodeAdd:Function,nodeDelete:Function,nodeEdit:Function,nodeCopy:Function,disabled:Boolean}),emits:{onNodeDelete:(e,n)=>B(e)&&B(n),onNodeCopy:e=>A(e),contextmenu:e=>B(e),onNodeFocus:e=>B(e),opened:()=>!0,closed:()=>!0,"update:modelValue":e=>"boolean"==typeof e},setup(e,n){const t=l(),o=l();return{eleRef:o,inputRef:t,copyText:l(""),oldData:z({}),...xe(e,n,{inputRef:t,eleRef:o})}}});const Ne=["action"];$e.render=function(e,o,a,l,r,d){return c(),N(S,{to:"body"},[D(k,{name:"dialog-fade",onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave},{default:E((()=>[n(f("div",{style:b(e.position),onClick:o[1]||(o[1]=(...n)=>e.handleMenu&&e.handleMenu(...n)),ref:"eleRef",class:"zm-tree-contextmenu"},[f("ul",null,[(c(!0),u(O,null,M(e.menus,(n=>(c(),u(O,null,[e.editable||!["add","edit","delete"].includes(n.command)?(c(),u("li",{class:"zm-tree-menu-item",action:n.command,key:n.command},i(n.name),9,Ne)):p("v-if",!0)],64)))),256))]),n(f("textarea",{class:"copy-textarea",ref:"inputRef","onUpdate:modelValue":o[0]||(o[0]=n=>e.copyText=n)},null,512),[[w,e.copyText]])],4),[[t,e.modelValue]])])),_:1},8,["onAfterEnter","onAfterLeave"])])},$e.__file="src/components/contextmenu/src/contextmenu.vue";const Se=[{name:"复制文本",command:"copy"},{name:"新增节点",command:"add"},{name:"编辑节点",command:"edit"},{name:"删除节点",command:"delete"}],De=ve({data:{type:Object,required:!0},props:{type:ge(Object),default:()=>({id:"id",pid:"pid",label:"label",expand:"expand",children:"children"})},toolBar:{type:[Object,Boolean],default:()=>({expand:!0,scale:!0,zoom:!0,restore:!0,fullscreen:!0})},disabled:{type:Boolean,default:!1},scalable:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},draggableOnNode:{type:Boolean,default:!1},nodeDraggable:{type:Boolean,default:!0},cloneNodeDrag:{type:Boolean,default:!0},onlyOneNode:{type:Boolean,default:!0},clickDelay:{type:Number,default:260},defaultExpandLevel:Number,nodeDragStart:Function,nodeDraging:Function,nodeDragEnd:Function,horizontal:Boolean,selectedKey:{type:[Array,String,Number]},collapsable:Boolean,renderContent:Function,labelStyle:Object,labelClassName:{type:[Function,String]},selectedClassName:{type:[Function,String]},defineMenus:{type:ge(Array),default:()=>Se},nodeAdd:Function,nodeDelete:Function,nodeEdit:Function,nodeCopy:Function,filterNodeMethod:Function}),Ee=(e,{emit:n},t)=>{const o=l(0),a=l(0),d=l(!1);function s(e,n){const l=t.zoomRef.value,r=t.treeRef.value,d=l.clientWidth/2,s=l.clientHeight/2;let c=l.clientHeight-r.clientHeight,u=l.clientWidth-r.clientWidth;c>0&&(c=0),u>0&&(u=0),o.value=e>d?d:e<u?u:e,a.value=n<c?c:n>s?s:n}function c(e,t){s(e,t),n("on-drag-stop",{x:e,y:t})}const u=l(!1),i=z({value:{}});const p=l(!1),f=l(0),m=l(0),g=l({});const y=l(1);function b(n){if(!e.scalable)return;const t=Number((Number(y.value)+n).toFixed(1));y.value=n>0?Math.min(3,t):Math.max(.3,t)}function x(e,n,t){d.value=!0;const l=e.offsetLeft-n,r=e.offsetTop-t;o.value-=l,a.value-=r,s(o.value,a.value)}let $;const N=z(Object.assign({id:"id",pid:"pid",label:"label",expand:"expand",children:"children"},e.props));const S=l(!1);function D(e){const{expand:n,children:t}=N;e.forEach((e=>{e[n]&&(e[n]=!1),e[t]&&D(e[t])}))}const E=l(!1);function k(e,n){Array.isArray(e)?e.forEach((e=>{e.expand=n,e.children&&k(e.children,n)})):(e.expand=n,e.children&&k(e.children,n))}function O(e){L.value=T(e)}const M=r((()=>({width:100/y.value+"%",height:100/y.value+"%",transform:`scale(${y.value})`}))),w=r((()=>`${Math.round(100*y.value)}%`)),R=r((()=>e.draggableOnNode||!e.nodeDraggable?"":".tree-org-node-label")),_=r((()=>E.value?"收起全部节点":"展开全部节点")),F=r((()=>E.value?"收起全部节点":"展开全部节点")),B=l({}),A=r((()=>{const{cloneNodeDrag:n,onlyOneNode:t,data:o}=e;return{drag:e.nodeDraggable,dragData:{keys:N,nodeMoving:u,parenNode:i,cloneNodeDrag:n,onlyOneNode:t,contextmenu:p,cloneData:B,data:o},handleStart:e.nodeDragStart,handleMove:e.nodeDraging,handleEnd:e.nodeDragEnd}}));function T(e){const n=(e,t)=>{const{id:o,label:a,pid:l,expand:r,children:d}=N,s={};Object.keys(e).map((n=>{["hidden","disabled","className","style"].includes(n)&&(s[n]=e[n])}));const c=e[d],u=t+1;return{...s,id:e[o],label:e[a],pid:e[l],expand:e[r],children:c?c.map((e=>n(e,u))):void 0,$$level:t,$$data:e,$$focused:e.focused||!1}};return n(e,0)}h((()=>e.horizontal),(()=>{C((()=>{c(o.value,a.value)}))}));const L=l(T(e.data));h((()=>e.data),(()=>{O(e.data)}),{deep:!0});const j=z({visible:!0,data:{expand:!0,scale:!0,zoom:!0,restore:!0,fullscreen:!0}});return v((()=>{"object"==typeof e.toolBar?Object.assign(j.data,e.toolBar):e.toolBar||(j.visible=!1)})),{keys:N,left:o,top:a,menuX:f,menuY:m,nodeMoving:u,zoomStyle:M,tools:j,zoomPercent:w,dragCancel:R,expandTitle:_,fullTiltle:F,nodeargs:A,expanded:E,fullscreen:S,treeData:L,autoDragging:d,contextmenu:p,menuData:g,cloneData:B,filter:function(n){const t=e.filterNodeMethod;if(!t)throw new Error("[Tree] filterNodeMethod is required when filter");const o=function(e){const a=e.children||[];if(a.forEach((e=>{e.$$hidden=!t.call(e,n,e),o(e)})),e.$$hidden&&a.length){let n=!0;n=a.some((e=>!e.$$hidden)),e.$$hidden=!n}n&&!e.$$hidden&&e.children&&(e.expand=!0)};o(L.value)},setData:O,zoomWheel:function(t){e.scalable&&(t.preventDefault(),t.deltaY<0?b(.1):b(-.1),n("on-zoom",y.value))},onDrag:function(e,t){d.value=!1,o.value=e,a.value=t,n("on-drag",{x:e,y:t})},onDragStop:c,expandChange:function(){E.value=!E.value,k(L.value,E.value),E.value||C((()=>{c(o.value,a.value)}))},handleFullscreen:function(e){S.value=!S.value,"esc"!==e&&(S.value?function(){const e=t.eleRef.value;e.requestFullscreen&&e.requestFullscreen()}():document.exitFullscreen&&document.exitFullscreen())},zoomOrgchart:b,restoreOrgchart:function(){y.value=1,o.value=0,a.value=0,n("on-restore")},handleExpand:function(e,t){e.stopPropagation();const o=document.querySelector(".is-root");if(o){const a=o.offsetLeft,l=o.offsetTop;t.expand=!t.expand,!t.expand&&t.children&&D(t.children),C((()=>{x(o,a,l)})),n("on-expand",e,t.$$data,t)}},nodeMouseenter:function(e,t){return u.value&&(i.value=t),n("on-node-mouseenter",e,t.$$data,t),!0},nodeMouseleave:function(e,t){return u.value&&(i.value=null),n("on-node-mouseleave",e,t.$$data,t),!0},nodeContextmenu:function(e,n){e.stopPropagation(),e.preventDefault(),p.value=!0,f.value=e.clientX,m.value=e.clientY,g.value=n},handleBlur:function(e,t,o){const{id:a,label:l}=N,r=g.value.children||[];for(let e=r.length;e>0;e--){const n=r[e-1];if(""===n[a]&&""===n[l]){r.splice(e-1,1);break}}n("on-node-blur",e,t,o)},handleClick:function(t,o){clearTimeout($),$=setTimeout((()=>{n("on-node-click",t,o.$$data,o)}),e.clickDelay)},handleDblclick:function(e,t){clearTimeout($),n("on-node-dblclick",e,t.$$data,t)}}};var Ce=a({name:"vue3TreeOrg",components:{Tools:G,CloneOrg:ye,Draggable:he,Contextmenu:$e,TreeOrgNode:H},directives:{nodedrag:P},props:De,emits:{"on-drag":({x:e,y:n})=>T(e)&&T(n),"on-drag-stop":({x:e,y:n})=>T(e)&&T(n),"on-restore":()=>!0,"on-zoom":e=>T(e),"on-expand":(e,n,t)=>e instanceof MouseEvent&&B(t)&&B(n),"on-node-blur":(e,n,t)=>e instanceof FocusEvent&&B(t)&&B(n),"on-node-click":(e,n,t)=>e instanceof MouseEvent&&B(t)&&B(n),"on-node-dblclick":(e,n,t)=>e instanceof MouseEvent&&B(t)&&B(n),"on-node-mouseenter":(e,n,t)=>e instanceof MouseEvent&&B(t)&&B(n),"on-node-mouseleave":(e,n,t)=>e instanceof MouseEvent&&B(t)&&B(n),"on-contextmenu":e=>B(e),"on-node-copy":e=>A(e),"on-node-delete":e=>B(e),"on-node-focus":(e,n,t)=>e instanceof FocusEvent&&B(t)&&B(n)},setup(e,n){const t=!!n.slots.default,o=!!n.slots.expand,a=l(),r=l(),d=l();return{eleRef:a,treeRef:r,zoomRef:d,defaultSlot:t,expandSlot:o,...Ee(e,n,{eleRef:a,treeRef:r,zoomRef:d})}}});const ze={ref:"eleRef",class:"zm-tree-org"},ke={class:"tree-org-node__text"},Oe=f("span",{class:"tree-org-node__expand-btn"},null,-1),Me={class:"tree-org-node__text"},we=f("span",{class:"tree-org-node__expand-btn"},null,-1);Ce.render=function(e,n,t,o,a,l){const r=$("tree-org-node"),d=$("Draggable"),s=$("Tools"),v=$("clone-org"),g=$("Contextmenu");return c(),u("div",ze,[f("div",{ref:"zoomRef",class:"zoom-container",style:b(e.zoomStyle),onWheel:n[1]||(n[1]=(...n)=>e.zoomWheel&&e.zoomWheel(...n))},[D(d,{x:e.left,y:e.top,class:m({dragging:e.autoDragging}),onDragging:e.onDrag,onDragstop:e.onDragStop,draggable:e.draggable,"drag-cancel":e.dragCancel},{default:E((()=>[f("div",{ref:"treeRef",class:m(["tree-org",{horizontal:e.horizontal,collapsable:e.collapsable}])},[D(r,{data:e.treeData,props:e.keys,horizontal:e.horizontal,labelStyle:e.labelStyle,collapsable:e.collapsable,renderContent:e.renderContent,selectedKey:e.selectedKey,defaultExpandLevel:e.defaultExpandLevel,selectedClassName:e.selectedClassName,labelClassName:e.labelClassName,vNodedrag:e.nodeargs,onOnExpand:e.handleExpand,onNodeClick:e.handleClick,onNodeDblclick:e.handleDblclick,onNodeMouseenter:e.nodeMouseenter,onNodeMouseleave:e.nodeMouseleave,onNodeContextmenu:e.nodeContextmenu,onNodeFocus:n[0]||(n[0]=(n,t,o)=>{e.$emit("on-node-focus",n,t,o)}),onNodeBlur:e.handleBlur},R({_:2},[e.defaultSlot?{name:"default",fn:E((({node:n})=>[x(e.$slots,"default",{node:n},(()=>[f("div",ke,[f("span",null,i(n.label),1)])]))]))}:void 0,e.expandSlot?{name:"expand",fn:E((({node:n})=>[x(e.$slots,"expand",{node:n},(()=>[Oe]))]))}:void 0]),1032,["data","props","horizontal","labelStyle","collapsable","renderContent","selectedKey","defaultExpandLevel","selectedClassName","labelClassName","vNodedrag","onOnExpand","onNodeClick","onNodeDblclick","onNodeMouseenter","onNodeMouseleave","onNodeContextmenu","onNodeBlur"])],2)])),_:3},8,["x","y","class","onDragging","onDragstop","draggable","drag-cancel"])],36),e.tools.visible?(c(),N(s,{key:0,tools:e.tools.data,scale:e.zoomPercent,onOnExpand:e.expandChange,onOnScale:e.zoomOrgchart,onOnRestore:e.restoreOrgchart,onOnFullscreen:e.handleFullscreen},null,8,["tools","scale","onOnExpand","onOnScale","onOnRestore","onOnFullscreen"])):p("v-if",!0),e.nodeDraggable?(c(),N(v,{key:1,modelValue:e.nodeMoving,"onUpdate:modelValue":n[2]||(n[2]=n=>e.nodeMoving=n),props:e.keys,data:e.cloneData,horizontal:e.horizontal,"label-style":e.labelStyle,collapsable:e.collapsable,"render-content":e.renderContent,"label-class-name":e.labelClassName},R({_:2},[e.defaultSlot?{name:"default",fn:E((({node:n})=>[x(e.$slots,"default",{node:n},(()=>[f("div",Me,[f("span",null,i(n[e.keys.label]),1)])]))]))}:void 0,e.expandSlot?{name:"expand",fn:E((({node:n})=>[x(e.$slots,"expand",{node:n},(()=>[we]))]))}:void 0]),1032,["modelValue","props","data","horizontal","label-style","collapsable","render-content","label-class-name"])):p("v-if",!0),e.defineMenus.length?(c(),N(g,{key:2,modelValue:e.contextmenu,"onUpdate:modelValue":n[3]||(n[3]=n=>e.contextmenu=n),x:e.menuX,y:e.menuY,node:e.menuData,data:e.data,props:e.keys,menus:e.defineMenus,disabled:e.disabled,"node-add":e.nodeAdd,"node-delete":e.nodeDelete,"node-edit":e.nodeEdit,"node-copy":e.nodeCopy,onContextmenu:n[4]||(n[4]=n=>{e.$emit("on-contextmenu",n)}),onOnNodeCopy:n[5]||(n[5]=n=>{e.$emit("on-node-copy",n)}),onOnNodeDelete:n[6]||(n[6]=n=>{e.$emit("on-node-delete",n)})},null,8,["modelValue","x","y","node","data","props","menus","disabled","node-add","node-delete","node-edit","node-copy"])):p("v-if",!0)],512)},Ce.__file="src/components/tree-org/src/tree.vue",Ce.install=function(e){e.component(Ce.name,Ce)};const Re=[Ce];var _e={install:function(e){Re.forEach((n=>{e.component(n.name,n)})),e.use(V)},Vue3TreeOrg:Ce};export{Ce as Vue3TreeOrg,_e as default};
